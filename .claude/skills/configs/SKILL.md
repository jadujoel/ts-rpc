---
name: configs
description: Update ecasOptions.ts sound configuration files using ConfigBuilder API. Handles sound designer requests for event mapping, random selection, volume control, and audio routing.
---

# ecasOptions.ts Configuration Guide

You are an expert at configuring Evolution game audio using the ECAS (Evolution Client Audio System) ConfigBuilder API. When this skill is active, help sound designers translate their requests into TypeScript configuration code for `ecasOptions.ts` files.

sourceNames correspond to name of sound file without extension, e.g. `hit1` for `hit1.mp3`.

### Globals

The preload script (`preload.ts`) makes several utilities available globally in `ecasOptions.ts` files **without imports**:

**Global Variables:**
```typescript
// Available globally without import:
ConfigBuilder              // Main config builder class
EcasEvents                 // ECAS event constants namespace
Common                     // Common game events (DeviceDesktop, DeviceMobile, etc.)
UserPreferencesVolumeBus   // Volume bus enum (.Effects, .Music, .Voice)
db                         // db(-6) → converts decibels to linear gain
soundFileDuration          // soundFileDuration(constants.MYSOUND) → duration in seconds
languageTriggersV1         // Helper for generating language trigger configs
BeatSync44                 // 4/4 beat sync helper
BeatSync34                 // 3/4 beat sync helper
BeatSync68                 // 6/8 beat sync helper
MusicalDuration44          // 4/4 musical duration helper
MusicalDuration            // Musical time to seconds converter
MusicalDurationMs          // Musical time to milliseconds converter
```

**Prototype Extensions:**
```typescript
// Array extensions
[1, 2, 3].first()          // → 1 (first element)
[1, 2, 3].last()           // → 3 (last element)
[1, 2].repeat(3)           // → [1, 2, 1, 2, 1, 2] (repeat array N times)

// Number extensions
(-6).db                    // → 0.501187 (decibels to linear)
2.octaves                  // → 2400 (octaves to cents)
100.range(50)              // → [50, 150] (middle ± delta)
```

**Usage:** You can use these globals directly in `ecasOptions.ts` without imports:
```typescript
// ✅ Using globals (no imports needed)
const builder = new ConfigBuilder(constants);

builder.buses({
  music: {
    destinationName: UserPreferencesVolumeBus.Music,
    gain: db(-6)  // or: (-6).db
  }
});

builder.events({
  [Common.DeviceDesktop]: [
    { action: 'updateMuteBehaviour', muteOnInvisible: false }
  ]
});
```

However, explicit imports are recommended for better IDE support and type checking:
```typescript
// ✅ With imports (recommended for type safety)
import { ConfigBuilder } from "@/utils/defineConfigV2.ts";
import { db } from "@/utils/helpers.ts";
import { UserPreferencesVolumeBus } from "@netent-tech/ecas-provider";
import { Common } from "@/utils/common.ts";
```

## 1. ConfigBuilder Pattern

Every `ecasOptions.ts` file follows this structure:

```typescript
import * as constants from "./generated/constants.ts";

const builder = new ConfigBuilder(constants);

// Configuration methods here...
builder.buses({ /* ... */ });
builder.buffers({ /* ... */ });
builder.events({ /* ... */ });

builder.extendCommonConfig(); // Always call last
export default <EcasOptions> builder.build();
```

**Critical**:
- Always import `* as constants from "./generated/constants.ts"` for type-safe sound names
- Call `builder.extendCommonConfig()` at the end to inherit common UI sounds
- The `generated/constants.ts` file is auto-generated by the encoder—never edit it manually

## 2. Common Sound Designer Requests

### 2.1 Play Random Footsteps on Event X

**Pattern**: Use `containers()` with random strategy + `events()` mapping

```typescript
// Define available footstep sound files
builder.containers({
  footsteps: {
    strategy: 'random-standard',        // or 'random-shuffle' to avoid repeats
    avoidRepeatingLast: 2,              // Don't repeat last 2 sounds
    detune: [[-30, 30]],                // Random pitch variation ±30 cents
    gain: db(-6),                       // Volume in decibels
    destinationName: UserPreferencesVolumeBus.Effects,
    voices: [
      { sourceName: constants.FOOTSTEP_1 },
      { sourceName: constants.FOOTSTEP_2 },
      { sourceName: constants.FOOTSTEP_3 },
      { sourceName: constants.FOOTSTEP_4 },
    ]
  }
});

// Map game event to play container
builder.events({
  onPlayerWalk: [
    { action: 'containerPlay', name: 'footsteps' }
  ]
});
```

**Strategies**:
- `'random-standard'`: Pure random selection
- `'random-shuffle'`: Shuffled deck (no repeats until all played)
- `'sequential'`: Play in order
- `'weighted'`: Requires `weight` property on each voice

### 2.2 Add Pitch Variation

**Pattern**: Use `detune` parameter with min/max array

```typescript
builder.buffers({
  hitSound: {
    sourceName: constants.HIT,
    detune: [[-50, 50]],          // Random pitch ±50 cents (semitone = 100)
    destinationName: UserPreferencesVolumeBus.Effects
  }
});
```

For multiple buffers with same settings, use **defaults**:

```typescript
builder.buffers({
  hit1: { sourceName: constants.HIT_1 },
  hit2: { sourceName: constants.HIT_2 },
  hit3: { sourceName: constants.HIT_3 },
}, {
  detune: [[-40, 40]],                // Applied to all
  gain: 0.8,
  destinationName: UserPreferencesVolumeBus.Effects
});
```

### 2.3 Control Volume/Gain

**Three levels** of volume control:

```typescript
// 1. Bus level (affects everything routed to this bus)
builder.buses({
  music: {
    gain: db(-6),                     // -6 decibels
    destinationName: UserPreferencesVolumeBus.Music
  }
});

// 2. Buffer level (affects this buffer every time it plays)
builder.buffers({
  explosion: {
    sourceName: constants.EXPLOSION,
    gain: db(-3),                     // Buffer louder than bus
    destinationName: 'music'
  }
});

// 3. Action level (affects only this specific play action)
builder.events({
  onBigWin: [
    {
      action: 'bufferPlay',
      name: 'explosion',
      gain: 1.5                       // 150% of buffer gain
    }
  ]
});
```

**Helper functions** from `src/utils/helpers.ts`:
- `db(-6)`: Converts decibels to linear gain (0.5 linear)
- `lin(0.5)`: Converts linear to decibels (-6 dB)
- `ms(1000)`: Converts milliseconds to seconds (1.0s)

### 2.4 Map Game Event to Audio

**Simple 1:1 mapping**:

```typescript
builder.events({
  onButtonClick: [
    { action: 'bufferPlay', name: 'uiClick' }
  ]
});
```

**Multiple actions** (play sound + duck music):

```typescript
builder.events({
  onDealerSpeak: [
    { action: 'bufferPlay', name: 'voice_placeBets' },
    {
      action: 'busApplyEnvelope',
      busId: 'music',
      paramId: 'gain',
      points: [
        { pos: 0, val: 1.0 },         // Start at 100%
        { pos: 500, val: 0.3 },       // Duck to 30% over 500ms
      ]
    }
  ]
});
```

**Chained actions** with callbacks:

```typescript
builder.events({
  onGameStart: [
    {
      action: 'loadTheseSounds',
      ids: [constants.BGM_INTRO, constants.BGM_LOOP],
      onEnded: builder.actions([
        { action: 'bufferPlay', name: 'bgmIntro' },
        { action: 'sendAudioEvent', eventName: 'soundsReady' }
      ])
    }
  ]
});
```

### 2.5 Prevent Voice Overlap (Stealers)

**Pattern**: Use `stealers()` to limit polyphony

```typescript
// Define stealer (voice limiter)
builder.stealers({
  voice: {
    maxVoices: 1,                     // Only 1 voice at a time
    strategy: 'kill-oldest',          // Stop oldest when limit reached
    fadeOut: 0.1,                     // 100ms fade when stealing
    minTimeBetween: 0.5               // Minimum 500ms between plays
  }
});

// Assign buffers to stealer
builder.buffers({
  voice_placeBets: {},
  voice_noMoreBets: {},
  voice_result: {},
}, {
  stealerName: 'voice',               // All use same stealer
  detune: [[-40, 30]],
  gain: db(-4),
  destinationName: UserPreferencesVolumeBus.Voice
});
```

**Strategies**:
- `'kill-oldest'`: Stop the oldest playing voice (common for announcements)
- `'kill-newest'`: Stop the newest voice (less common)

### 2.6 Complete Footsteps Example

Combining containers, detune, stealers, and event mapping:

```typescript
// Prevent too many footsteps overlapping
builder.stealers({
  footsteps: {
    maxVoices: 3,                     // Max 3 simultaneous footsteps
    strategy: 'kill-oldest',
    fadeOut: 0.05                     // Quick fade
  }
});

// Random footstep pool with pitch variation
builder.containers({
  footsteps: {
    strategy: 'random-shuffle',       // No repeats until all played
    avoidRepeatingLast: 2,
    detune: [[-25, 25]],              // Subtle pitch variation
    gain: db(-8),
    destinationName: UserPreferencesVolumeBus.Effects,
    voices: [
      { sourceName: constants.STEP_WOOD_1, stealerName: 'footsteps' },
      { sourceName: constants.STEP_WOOD_2, stealerName: 'footsteps' },
      { sourceName: constants.STEP_WOOD_3, stealerName: 'footsteps' },
      { sourceName: constants.STEP_WOOD_4, stealerName: 'footsteps' },
      { sourceName: constants.STEP_WOOD_5, stealerName: 'footsteps' },
    ]
  }
});

// Map to game event
builder.events({
  onFootstep: [{ action: 'containerPlay', name: 'footsteps' }]
});
```

## 3. ConfigBuilder API Reference

### 3.1 `buses(busConfig, defaults?)`

Define audio buses for routing and mixing.

```typescript
builder.buses({
  BigWinMusic: {
    destinationName: UserPreferencesVolumeBus.Music,  // User-controllable
    gain: db(-3)
  },
  BigWinEffects: {
    destinationName: UserPreferencesVolumeBus.Effects
    gain: 1
  }
});
```

**Key Parameters**:
- `destinationName`: `'OUTPUT'`, `'master'`, `UserPreferencesVolumeBus.Effects/Music/Voice`
- `gain`: Linear volume (0.0 to 1.0+) or use `db(-6)`
- `pan`: Stereo pan (-1.0 left, 0.0 center, 1.0 right)
- `inserts`: Array of effect names to apply

### 3.2 `buffers(bufferConfig, defaults?)`

Define individual sound buffers (single audio files).

```typescript
builder.buffers({
  buttonClick: {
    sourceName: constants.UI_CLICK,   // From generated/constants.ts
    gain: 0.8,
    detune: [[-20, 20]],              // Optional pitch randomization
    destinationName: UserPreferencesVolumeBus.Effects,
    stealerName: 'uiSounds',          // Optional voice limiting
    fadeIn: 0.01,                     // Fade in duration (seconds)
    fadeOut: 0.02,                    // Fade out duration (seconds)
    maxWaitTime: 1                    // Max queue time before dropping
  }
});
```

**Key Parameters**:
- `sourceName`: Must match constant from `generated/constants.ts`
- `destinationName`: Which bus to route to
- `gain`: Volume (linear or use `db()`)
- `detune`: Pitch in cents (100 = 1 semitone), or `[[-50, 50]]` for random
- `stealerName`: Name of stealer for voice limiting
- `syncerName`: Name of syncer for beat-synchronized playback
- `maxWaitTime`: Seconds to wait in queue before dropping (prevents buildup)
- `fadeIn`/`fadeOut`: Envelope durations in seconds
- `highpass`/`lowpass`: Filter cutoff frequencies in Hz

**Note**: If `sourceName` is omitted, defaults to the buffer name (key).

### 3.3 `containers(containerConfig, defaults?)`

Define sound pools for random selection or sequencing.

```typescript
builder.containers({
  randomHits: {
    strategy: 'random-shuffle',
    avoidRepeatingLast: 2,            // Memory of last N sounds
    gain: db(-6),
    detune: [[-30, 30]],
    destinationName: UserPreferencesVolumeBus.Effects,
    voices: [
      { sourceName: constants.HIT_1, weight: 2 },  // 2x more likely (if weighted)
      { sourceName: constants.HIT_2 },
      { sourceName: constants.HIT_3 },
      { name: 'hit4Buffer' }          // Can reference buffer by name
    ]
  }
});
```

**Strategies**:
- `'random-standard'`: Pure random
- `'random-shuffle'`: Shuffle deck (no repeats until exhausted)
- `'sequential'`: Play in order
- `'weighted'`: Each voice can have `weight` property

**Voice Options**:
- `sourceName`: Direct sound reference
- `name`: Reference to existing buffer
- `weight`: For weighted random (default 1)
- `stealerName`: Per-voice stealer

### 3.4 `events(eventConfig)`

Map game events to audio actions.

```typescript
builder.events({
  // Simple buffer play
  onButtonClick: [
    { action: 'bufferPlay', name: 'buttonClick' }
  ],

  // Container play
  onHit: [
    { action: 'containerPlay', name: 'randomHits' }
  ],

  // Multiple actions
  onWin: [
    { action: 'bufferPlay', name: 'winSound', gain: 1.2 },
    { action: 'busApplyEnvelope', busId: 'music', paramId: 'gain', points: [
      { pos: 0, val: 1.0 },
      { pos: 1000, val: 0.3 }
    ]}
  ],

  // With timing
  onGameStart: [
    { action: 'bufferPlay', name: 'intro', initialDelay: 0.5 }
  ],

  // Stop sounds
  onGameEnd: [
    { action: 'bufferStopByName', name: 'bgmLoop', fadeOut: 2.0 }
  ]
});
```

**Common Actions**:
- `bufferPlay`: Play a buffer
- `containerPlay`: Play from a container
- `bufferStopByName`: Stop specific buffer
- `bufferStopAll`: Stop all buffers
- `busApplyEnvelope`: Automate bus parameter over time
- `loadPackage`: Load additional sound package
- `sendAudioEvent`: Send custom audio event
- `updateMuteBehaviour`: Configure pause/mute behavior

**Action Parameters**:
- `initialDelay`: Delay in seconds before action
- `gain`: Override buffer gain
- `fadeIn`/`fadeOut`: Override fade times
- `onStarted`: Actions to run when started
- `onEnded`: Actions to run when completed

**Note**: Can call `builder.events()` multiple times to organize by section.

### 3.5 `stealers(stealerConfig)`

Define voice limiters to prevent excessive polyphony.

```typescript
builder.stealers({
  voice: {
    maxVoices: 1,                     // Strict limit
    strategy: 'kill-oldest',
    fadeOut: 0.1,
    minTimeBetween: 0.5               // Minimum seconds between plays
  },
  effects: {
    maxVoices: 8,                     // Allow multiple effects
    strategy: 'kill-oldest',
    fadeOut: 0.05
  }
});
```

**Parameters**:
- `maxVoices`: Maximum simultaneous voices
- `strategy`: `'kill-oldest'` or `'kill-newest'`
- `fadeOut`: Fade duration when stealing (seconds)
- `minTimeBetween`: Minimum time between plays (seconds)

### 3.6 `stateConfig(options)`

Define state machine for complex event routing and language selection.

```typescript
builder.stateConfig({
  events: {
    // Language variants
    language_bp: {
      female: 'language_bp_f',
      male: 'language_bp_m',
      fallback: 'language_bp_f'
    },
    language_en: {
      female: 'language_en_f',
      male: 'language_en_m',
      fallback: 'language_en_f'
    },
  },
  children: {
    // Nested states if needed
  }
});
```

**Purpose**: Maps game events to different audio events based on state (e.g., language, gender).

### 3.7 `loadrConfig(config)`

Configure sound loading behavior.

```typescript
builder.loadrConfig({
  loadPath: '/frontend/gametech/sounds/evo-baccarat/',  // CDN path
  queue: true,                        // Queue events before ready
  preload: [constants.UI_CLICK]       // Sounds to load immediately
});
```

**Parameters**:
- `loadPath`: CDN path for loading sounds (auto-configured for live games)
- `queue`: If `true`, queue events received before sounds load
- `preload`: Array of sound names to load immediately

### 3.8 `extendCommonConfig()`

Inherit common UI sounds and buses. **Always call last**.

```typescript
builder.extendCommonConfig();
export default <EcasOptions> builder.build();
```

## 4. Critical Conventions

### ✅ DO

- **Use constants for sound names**: `sourceName: constants.MYSOUND` (type-safe)
- **Use `db()` for decibels**: `gain: db(-6)` is clearer than `gain: 0.501187`
- **Use linear for relative gains**: `gain: 0.8` when adjusting relative to another value
- **Set `maxWaitTime`**: Prevents sound queue buildup in live games (typically 1-3 seconds)
- **Call `extendCommonConfig()` last**: Inherits common UI sounds
- **Group related buffers**: Use defaults parameter to avoid repetition
- **Check existing sounds first**: Look in `src/packages/<package>/sounds/` directory
- **Use MARK comments**: Organize large configs with `// MARK: - Section Name`
- **Add voice stealers**: Especially for voice/announcement sounds
- **Route to correct bus**: Use `UserPreferencesVolumeBus.Effects/Music/Voice` for user control

### ❌ DON'T

- **Hardcode sound names**: Use `generated/constants.ts` exports, not strings
- **Edit generated files**: `generated/constants.ts` is auto-regenerated on every build
- **Forget to rebuild**: Run `bun run build` after adding new sound files
- **Skip stealers for voices**: Overlapping voices sound bad
- **Use Node.js APIs**: This is a Bun project—use Bun APIs
- **Chain too many actions**: Break complex sequences into multiple events
- **Ignore maxWaitTime**: Live games can build up huge queues without this

## 5. Complete Examples

### Example 1: Minimal Template (Baccarat)

```typescript
import { ConfigBuilder } from "@/utils/defineConfigV2.ts";
import { db } from "@/utils/helpers.ts";
import { UserPreferencesVolumeBus } from "@netent-tech/ecas-provider";
import type { EcasOptions } from "@netent-tech/ecas-provider";
import * as constants from "./generated/constants.ts";
import { Common } from "@/utils/common.ts";

const builder = new ConfigBuilder(constants);

// MARK: - Buses
builder.buses({
  master: { destinationName: 'OUTPUT' }
});

// MARK: - Voice
builder.stealers({
  voice: { maxVoices: 1, strategy: 'kill-oldest', fadeOut: 0.1 }
});

builder.buffers({
  voice_bankerWins: {},
  voice_playerWins: {},
  voice_tie: {},
}, {
  stealerName: 'voice',
  detune: [[-40, 30]],
  gain: db(-4),
  destinationName: UserPreferencesVolumeBus.Voice
});

// MARK: - Events
builder.events({
  [Common.DeviceDesktop]: [
    { action: 'updateMuteBehaviour', muteOnInvisible: false, pauseOnInvisible: false }
  ],
  voice_bankerWins: [{ action: 'bufferPlay', name: 'voice_bankerWins' }],
  voice_playerWins: [{ action: 'bufferPlay', name: 'voice_playerWins' }],
  voice_tie: [{ action: 'bufferPlay', name: 'voice_tie' }],
});

// MARK: - State & Loading
builder.stateConfig({
  events: {
    language_en: { female: 'language_en_f', male: 'language_en_m', fallback: 'language_en_f' },
  },
  children: {},
});

builder.loadrConfig({
  loadPath: '/frontend/gametech/sounds/evo-baccarat/',
  queue: true,
});

builder.extendCommonConfig();
export default <EcasOptions> builder.build();
```

### Example 2: Random Variations (Blackjack)

```typescript
// MARK: - Voice Containers with Round-Robin
builder.stealers({
  voice: { maxVoices: 1, strategy: 'kill-oldest', fadeOut: 0.1 }
});

builder.containers({
  voice_placeBets: {
    avoidRepeatingLast: 3,            // Don't repeat last 3
    destinationName: UserPreferencesVolumeBus.Voice,
    strategy: 'random-standard',
    detune: [[-40, 30]],
    gain: db(-4),
    voices: [
      { sourceName: constants.VOICE_PLACE_BETS, stealerName: 'voice' },
      { sourceName: constants.VOICE_PLACE_BETS_RR2, stealerName: 'voice' },
      { sourceName: constants.VOICE_PLACE_BETS_RR3, stealerName: 'voice' },
      { sourceName: constants.VOICE_PLACE_BETS_RR4, stealerName: 'voice' },
      { sourceName: constants.VOICE_PLACE_BETS_RR5, stealerName: 'voice' },
    ]
  }
});

// MARK: - Language System
builder.events({
  voice_placeBets: [{ action: 'containerPlay', name: 'voice_placeBets' }],

  // Auto-generate language loading events
  ...builder.languages({
    languages: ['en_f', 'en_m', 'bp_f', 'bp_m'],
    assets: [
      'voice_placeBets',
      'voice_placeBets_rr2',
      'voice_placeBets_rr3',
      'voice_placeBets_rr4',
      'voice_placeBets_rr5',
    ]
  }),
});
```

### Example 3: Effects with Detune (Crazy Time)

```typescript
// MARK: - Effects with Pitch Randomization
builder.buffers({
  cashHuntAimConfirmed: {
    sourceName: constants.CT_CASH_HUNT_AIM_CONFIRMED,
    detune: [[-20, 20]]
  },
  cashHuntCannonShoot: {
    sourceName: constants.CT_CASH_HUNT_CANNON_SHOOT,
    detune: [[-20, 20]]
  },
  wheelClick: {
    sourceName: constants.WHEEL_CLICK,
    detune: [[-15, 15]]
  },
}, {
  gain: 0.8,
  maxWaitTime: 1,
  destinationName: UserPreferencesVolumeBus.Effects
});

// MARK: - Event Mapping
builder.events({
  cashHuntAimConfirmed: [
    { action: 'bufferPlay', name: 'cashHuntAimConfirmed' }
  ],
  cashHuntCannonShoot: [
    { action: 'bufferPlay', name: 'cashHuntCannonShoot' }
  ],
  wheelTick: [
    { action: 'bufferPlay', name: 'wheelClick' }
  ],
});
```

## 6. Workflow Guidance

When a sound designer makes a request, follow this workflow:

### Step 1: Parse the Request

Identify the pattern:
- **"Play random X"** → Container with `random-standard` or `random-shuffle`
- **"Add variation to Y"** → Add `detune: [[-30, 30]]` parameter
- **"On event Z, play..."** → Event mapping with `builder.events()`
- **"Lower volume of..."** → Adjust `gain` at buffer, bus, or action level
- **"Prevent overlap"** → Add stealer with `maxVoices`
- **"Duck music when..."** → Bus envelope in event action

### Step 2: Check Existing Configuration

```typescript
// Read the current ecasOptions.ts structure
// Look for existing patterns to maintain consistency
```

### Step 3: Verify Sound Files Exist

```bash
# Check available sounds in package
ls src/packages/<package>/sounds/

# Check generated constants
cat src/packages/<package>/generated/constants.ts | grep -i "keyword"
```

### Step 4: Implement the Change

Use the appropriate ConfigBuilder method(s):
- `builder.buffers()` for individual sounds
- `builder.containers()` for random selection
- `builder.events()` for event mapping
- `builder.stealers()` for voice limiting

### Step 5: Apply Consistent Conventions

- Use `constants.SOUNDNAME` for all sound references
- Use `db()` for decibel values
- Group related buffers with defaults parameter
- Add MARK comments for organization
- Route to appropriate `UserPreferencesVolumeBus`

### Step 6: Test

```bash
# Encode and serve locally
bun run start <package>

# In game URL, add hash parameter
# Example: https://game.url/#?localSounds
```

The game will fetch sounds from `localhost:49152` instead of CDN, allowing real-time testing.

## 7. Helper Utilities

### From `src/utils/helpers.ts`

```typescript
import { db, lin, ms } from "@/utils/helpers.ts";

db(-6)    // Converts decibels to linear gain (0.501187)
db(0)     // Unity gain (1.0)
db(-∞)    // Silence (0.0)

lin(0.5)  // Converts linear to decibels (-6.020599...)
ms(1000)  // Converts milliseconds to seconds (1.0)
```

### From `src/utils/common.ts`

```typescript
import { Common } from "@/utils/common.ts";

// Platform detection events
Common.DeviceDesktop
Common.DeviceMobile
Common.DeviceTablet

// Use in events to configure platform-specific behavior
builder.events({
  [Common.DeviceDesktop]: [
    { action: 'updateMuteBehaviour', muteOnInvisible: false }
  ]
});
```

### UserPreferencesVolumeBus Enum

```typescript
import { UserPreferencesVolumeBus } from "@netent-tech/ecas-provider";

// Always route sounds to user-controllable buses
UserPreferencesVolumeBus.Effects   // SFX and UI sounds
UserPreferencesVolumeBus.Music     // Background music
UserPreferencesVolumeBus.Voice     // Dealer voice and announcements
```

## 8. Advanced Patterns

### Crossfading Music Tracks

```typescript
builder.events({
  transitionToIntenseMusic: [
    {
      action: 'bufferPlay',
      name: 'musicIntense',
      fadeIn: 2.0,
      onStarted: builder.actions([
        { action: 'bufferStopByName', name: 'musicCalm', fadeOut: 2.0 }
      ])
    }
  ]
});
```

### Beat-Synchronized Playback

```typescript
builder.syncers({
  mainBeat: { tempo: 120 }  // 120 BPM
});

builder.buffers({
  drumLoop: {
    sourceName: constants.DRUM_LOOP,
    syncerName: 'mainBeat',
    destinationName: UserPreferencesVolumeBus.Music
  }
});
```

### Weighted Random Selection

```typescript
builder.containers({
  footsteps: {
    strategy: 'weighted',
    voices: [
      { sourceName: constants.STEP_1, weight: 3 },  // 3x more likely
      { sourceName: constants.STEP_2, weight: 2 },
      { sourceName: constants.STEP_3, weight: 1 },
    ]
  }
});
```

### Conditional Event Chains

```typescript
builder.events({
  onWinSmall: [
    {
      action: 'bufferPlay',
      name: 'winSound',
      onEnded: builder.actions([
        { action: 'sendAudioEvent', eventName: 'winSoundComplete' }
      ])
    }
  ],
  winSoundComplete: [
    { action: 'bufferPlay', name: 'cheerSound' }
  ]
});
```

## 9. Troubleshooting

### Sound Not Playing

1. Check `generated/constants.ts` contains the sound name
2. Verify sound file exists in `src/packages/<package>/sounds/`
3. Run `bun run build` to regenerate constants
4. Check browser console for ECAS errors
5. Verify event name matches what game sends

### Wrong Sound Playing

1. Check `sourceName` matches constant exactly (case-sensitive)
2. Verify correct container is mapped to event
3. Check if sound is being stolen by another instance

### Volume Too Low/High

1. Check buffer `gain` setting
2. Check bus `gain` setting
3. Check if routed to correct `UserPreferencesVolumeBus`
4. Verify user hasn't muted that volume category in game

### Sounds Overlapping

1. Add stealer with `maxVoices: 1`
2. Increase `fadeOut` duration on stealer
3. Set `minTimeBetween` on stealer

### Changes Not Reflected

1. Stop server: `Ctrl+C`
2. Clean cache: `bun run clean`
3. Rebuild: `bun run build`
4. Restart: `bun run start <package>`
5. Hard refresh browser: `Cmd+Shift+R` (Mac) or `Ctrl+Shift+R` (Windows)

---

## References

- ConfigBuilder implementation: `src/utils/defineConfigV2.ts`
- Helper functions: `src/utils/helpers.ts`
- Common events: `src/utils/common.ts`
- ECAS types: `@netent-tech/ecas-provider` package
- Migration guide: `docs/ecas-migration.md`
- Integration docs: `docs/js-clients-integration.md`
- ECAS documentation: https://docbox.netent.com/ecas/latest
